sap.ui.define([],                                                                                                                                                                                                                                              
    function () {                                                                                                                                                                                                                                              
        "use strict";                                                                                                                                                                                                                                          
        return {                                                                                                                                                                                                                                               
            onInit: function () {                                                                                                                                                                                                                              
                if (!this._sIdPrefix) {                                                                                                                                                                                                                        
                    this._sIdPrefix =                                                                                                                                                                                                                          
                        "br.com.trescoracoes.aprovctaspagar::sap.suite.ui.generic.template.ObjectPage.view.Details::ContasPagar--Documentos::";                                                                                                                
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                this.byId(this._sIdPrefix + "analyticalTable").getParent().setIgnoreFromPersonalisation("CompanyCodeName, SupplierFullName,CashPlanningGroupName,RepTypeText, DocTypeText, BranchText, HouseBankText, FormaPagamentoText, ItemStatus, tipo, Bs+
tat");                                                                                                                                                                                                                                                         
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onAfterRendering: function (oEvent) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                let oContentTable = this.byId(this._sIdPrefix + "analyticalTable");                                                                                                                                                                            
                oContentTable.attachBusyStateChanged(this._onBusyStateChanged);                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            _onBusyStateChanged: function (oEvent) {                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                let bBusy = oEvent.getParameter("busy");                                                                                                                                                                                                       
                if (!bBusy && !this._bColumnOptimizationDone) {                                                                                                                                                                                                
                    let oTable = oEvent.getSource();                                                                                                                                                                                                           
                    let oTpc = null;                                                                                                                                                                                                                           
                    if (sap.ui.table.TablePointerExtension) {                                                                                                                                                                                                  
                        oTpc = new sap.ui.table.TablePointerExtension(oTable);                                                                                                                                                                                 
                    } else {                                                                                                                                                                                                                                   
                        oTpc = new sap.ui.table.extensions.Pointer(oTable);                                                                                                                                                                                    
                    }                                                                                                                                                                                                                                          
                    let aColumns = oTable.getColumns();                                                                                                                                                                                                        
                    for (let i = aColumns.length; i >= 0; i--) {                                                                                                                                                                                               
                        oTpc.doAutoResizeColumn(i);                                                                                                                                                                                                            
                    }                                                                                                                                                                                                                                          
                    //This line can be commented if you want the columns to be adjusted on every scroll                                                                                                                                                        
                    //this._bColumnOptimizationDone = true;                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onUpdateGrpTes: function (oEvent) {                                                                                                                                                                                                                
                let header = this.getView().getBindingContext().getObject();                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                // if (header.encerrador == "" || header.aprov1 == "" || header.aprov2 == "" || header.aprov3 == "") {                                                                                                                                         
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Serviço                                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                this.getView().getModel().read("/SearchHelpCashPlanningGroup", {                                                                                                                                                                               
                    filters: [new sap.ui.model.Filter({ path: "Language", operator: sap.ui.model.FilterOperator.EQ, value1: 'PT' })],                                                                                                                          
                    success: function (oData) {                                                                                                                                                                                                                
                        this.generateFileSearchHelp(oData.results);                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    }.bind(this),                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    error: function (oError) {                                                                                                                                                                                                                 
                        //  sap.m.MessageBox.error(this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("upldFail"));                                                                                                                         
                        sap.m.MessageBox.error('Falha ao recuperar os Grupos de Tesouraria');                                                                                                                                                                  
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
                // } else {                                                                                                                                                                                                                                    
                //     sap.m.MessageBox.error('Não é possivel alterar o grupo. Já foi iniciado aprovação. ')                                                                                                                                                   
                // }                                                                                                                                                                                                                                           
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            generateFileSearchHelp: function (Results) {                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                var that = this;                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura lista Dropdown                                                                                                                                                                                                                       
                =================================================================== */                                                                                                                                                                         
                var oComboBox = new sap.m.ComboBox({                                                                                                                                                                                                           
                    id: 'oComboBox',                                                                                                                                                                                                                           
                    items: {                                                                                                                                                                                                                                   
                        path: '/items',                                                                                                                                                                                                                        
                        // width: '100%',                                                                                                                                                                                                                      
                        //Configura nome das colunas                                                                                                                                                                                                           
                        template: new sap.ui.core.ListItem({                                                                                                                                                                                                   
                            key: "{CashPlanningGroup}",                                                                                                                                                                                                        
                            text: "{CashPlanningGroup}",                                                                                                                                                                                                       
                            additionalText: "{CashPlanningGroupDescription}"                                                                                                                                                                                   
                        }),                                                                                                                                                                                                                                    
                        templateShareable: false                                                                                                                                                                                                               
                    },                                                                                                                                                                                                                                         
                    showSecondaryValues: true                                                                                                                                                                                                                  
                })                                                                                                                                                                                                                                             
                // Adiciona tabela como lista                                                                                                                                                                                                                  
                oComboBox.setModel(new sap.ui.model.json.JSONModel({ items: Results }));                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura conteúdo do Pop-up                                                                                                                                                                                                                   
                =================================================================== */                                                                                                                                                                         
                // var oContent = new sap.ui.layout.VerticalLayout({                                                                                                                                                                                           
                var oContent = new sap.m.VBox({                                                                                                                                                                                                                
                    width: '100%',                                                                                                                                                                                                                             
                    justifyContent: 'Inherit',                                                                                                                                                                                                                 
                    fitContainer: true,                                                                                                                                                                                                                        
                    items: [                                                                                                                                                                                                                                   
                        // new sap.m.Text({ text: this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("upldTextInfo") }),                                                                                                                    
                        new sap.m.Text({ text: 'Favor informar o Grupo de Tesouraria desejado.' }),                                                                                                                                                            
                                                                                                                                                                                                                                                               
                        new sap.m.Text({ text: ' ' }),                                                                                                                                                                                                         
                        oComboBox                                                                                                                                                                                                                              
                    ]                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura botão de impressão                                                                                                                                                                                                                   
                =================================================================== */                                                                                                                                                                         
                var oTriggerButton = new sap.m.Button({                                                                                                                                                                                                        
                    type: sap.m.ButtonType.Emphasized,                                                                                                                                                                                                         
                    // text: this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("upldText"),                                                                                                                                                
                    text: 'Alterar Grupo de Tesouraria',                                                                                                                                                                                                       
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        var grupoTesouraria = sap.ui.getCore().byId('oComboBox').getSelectedKey();                                                                                                                                                             
                                                                                                                                                                                                                                                               
                        if (!grupoTesouraria) {                                                                                                                                                                                                                
                            // sap.m.MessageBox.information(this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("upldTextInfo"));                                                                                                            
                            sap.m.MessageBox.information('Favor informar o Grupo de Tesouraria desejado.');                                                                                                                                                    
                        }                                                                                                                                                                                                                                      
                        else {                                                                                                                                                                                                                                 
                            pressDialog.close();                                                                                                                                                                                                               
                            that.alteraGrupo(grupoTesouraria);                                                                                                                                                                                                 
                        }                                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botão de cancelar                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var oCancelButton = new sap.m.Button({                                                                                                                                                                                                         
                    text: 'Cancelar',                                                                                                                                                                                                                          
                    type: 'Reject',                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    press: function () {                                                                                                                                                                                                                       
                        pressDialog.close();                                                                                                                                                                                                                   
                        pressDialog.destroy();                                                                                                                                                                                                                 
                        this.getView().removeAllDependents();                                                                                                                                                                                                  
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria janela pop-up                                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var pressDialog = new sap.m.Dialog({                                                                                                                                                                                                           
                    type: 'Message',                                                                                                                                                                                                                           
                    title: "Alterar Grupo de Tesouraria",                                                                                                                                                                                                      
                    resizable: true,                                                                                                                                                                                                                           
                    draggable: true,                                                                                                                                                                                                                           
                    titleAlignment: sap.m.TitleAlignment.Center,                                                                                                                                                                                               
                    content: oContent,                                                                                                                                                                                                                         
                    beginButton: oTriggerButton,                                                                                                                                                                                                               
                    endButton: oCancelButton,                                                                                                                                                                                                                  
                    afterClose: function () {                                                                                                                                                                                                                  
                        pressDialog.destroy();                                                                                                                                                                                                                 
                    },                                                                                                                                                                                                                                         
                    contentWidth: "20%",                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama janela pop-up                                                                                                                                                                                                                            
                =================================================================== */                                                                                                                                                                         
                pressDialog.open();                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            alteraGrupo: function (grupoTesouraria) {                                                                                                                                                                                                          
                var that = this;                                                                                                                                                                                                                               
                const cActionName = "/changeGroup";                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupa referência à tabela do relatório                                                                                                                                                                                                        
                =================================================================== */                                                                                                                                                                         
                var oExtApi = this.templateBaseExtension.getExtensionAPI();                                                                                                                                                                                    
                var oTable = this.getView().byId('br.com.trescoracoes.aprovctaspagar::sap.suite.ui.generic.template.ObjectPage.view.Details::ContasPagar--Documentos::analyticalTable')                                                                        
                // var oSelected = oTable.getSelectedItems()                                                                                                                                                                                                   
                var oSelected = oTable.getPlugins()[0].getTableBinding().getSelectedContexts();                                                                                                                                                                
                var oLength = oTable.getPlugins()[0].getTableBinding().getTotalSize();                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                for (let oContext of oSelected) {                                                                                                                                                                                                              
                    let oObject = oContext.getObject();                                                                                                                                                                                                        
                    let sDate = "datetime'" + new Date(oObject.NetDueDate.getTime() + (new Date().getTimezoneOffset() * 60 * 1000)) + "'";                                                                                                                     
                                                                                                                                                                                                                                                               
                    oExtApi.securedExecution(new Promise(function (fnResolve, fnReject) {                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        this.getView().getModel().callFunction(cActionName, {                                                                                                                                                                                  
                            method: "POST",                                                                                                                                                                                                                    
                            urlParameters: {                                                                                                                                                                                                                   
                                CompanyCode: encodeURIComponent(oObject.CompanyCode),                                                                                                                                                                          
                                PaymentRunID: encodeURIComponent(oObject.PaymentRunID),                                                                                                                                                                        
                                // NetDueDate: encodeURIComponent(new Date(oObject.NetDueDate.getTime() + (new Date().getTimezoneOffset() * 60 * 1000)).toLocaleDateString()),                                                                                 
                                NetDueDate: sDate,                                                                                                                                                                                                             
                                CashPlanningGroup: encodeURIComponent(oObject.CashPlanningGroup),                                                                                                                                                              
                                Supplier: encodeURIComponent(oObject.Supplier),                                                                                                                                                                                
                                PaymentDocument: encodeURIComponent(oObject.PaymentDocument),                                                                                                                                                                  
                                AccountingDocument: encodeURIComponent(oObject.AccountingDocument),                                                                                                                                                            
                                AccountingDocumentItem: encodeURIComponent(oObject.AccountingDocumentItem),                                                                                                                                                    
                                FiscalYear: encodeURIComponent(oObject.FiscalYear),                                                                                                                                                                            
                                novogrptesouraria: encodeURIComponent(grupoTesouraria),                                                                                                                                                                        
                                RepType: encodeURIComponent(oObject.RepType)                                                                                                                                                                                   
                            },                                                                                                                                                                                                                                 
                            success: function (oData, response) {                                                                                                                                                                                              
                                oLength--;                                                                                                                                                                                                                     
                                this.templateBaseExtension.getExtensionAPI().refreshAncestors();                                                                                                                                                               
                                if (oLength == 0)                                                                                                                                                                                                              
                                    window.history.go(-1);                                                                                                                                                                                                     
                                else {                                                                                                                                                                                                                         
                                    sap.m.MessageBox.success('Grupo alterado com sucesso');                                                                                                                                                                    
                                    that.getView().byId('br.com.trescoracoes.aprovctaspagar::sap.suite.ui.generic.template.ObjectPage.view.Details::ContasPagar--Documentos::analyticalTable').getModel().refresh(true);                                       
                                }                                                                                                                                                                                                                              
                            }.bind(this),                                                                                                                                                                                                                      
                            error: function (oError) {                                                                                                                                                                                                         
                                fnReject(oError);                                                                                                                                                                                                              
                            }                                                                                                                                                                                                                                  
                        });                                                                                                                                                                                                                                    
                    }.bind(this)                                                                                                                                                                                                                               
                    ).catch(                                                                                                                                                                                                                                   
                        function (oError) {                                                                                                                                                                                                                    
                            sap.m.MessageToast.show(oError)                                                                                                                                                                                                    
                        }),                                                                                                                                                                                                                                    
                        { busy: { set: true, check: true } })                                                                                                                                                                                                  
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                // var fnFunction = function () {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                //     return new Promise(function (fnResolve, fnReject) {                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                //         for (let i = 0; i < oSelected.length; i++) {                                                                                                                                                                                        
                //             // let sLinha = oSelected[i].getBindingContext().getObject();                                                                                                                                                                   
                //             let sLinha = oSelected[i].getObject();                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                //             that.extensionAPI.invokeActions(                                                                                                                                                                                                
                //                 cActionName,                                                                                                                                                                                                                
                //                 [],                                                                                                                                                                                                                         
                //                 {                                                                                                                                                                                                                           
                //                     CompanyCode: encodeURIComponent(sLinha.CompanyCode),                                                                                                                                                                    
                //                     PaymentRunID: encodeURIComponent(sLinha.PaymentRunID),                                                                                                                                                                  
                //                     NetDueDate: encodeURIComponent(new Date(sLinha.NetDueDate).toISOString().split(".")[0]),                                                                                                                                
                //                     CashPlanningGroup: encodeURIComponent(sLinha.CashPlanningGroup),                                                                                                                                                        
                //                     Supplier: encodeURIComponent(sLinha.Supplier),                                                                                                                                                                          
                //                     PaymentDocument: encodeURIComponent(sLinha.PaymentDocument),                                                                                                                                                            
                //                     AccountingDocument: encodeURIComponent(sLinha.AccountingDocument),                                                                                                                                                      
                //                     AccountingDocumentItem: encodeURIComponent(sLinha.AccountingDocumentItem),                                                                                                                                              
                //                     FiscalYear: encodeURIComponent(sLinha.FiscalYear),                                                                                                                                                                      
                //                     novogrptesouraria: encodeURIComponent(grupoTesouraria),                                                                                                                                                                 
                //                     RepType: encodeURIComponent(sLinha.RepType)                                                                                                                                                                             
                //                 }                                                                                                                                                                                                                           
                //             ).then(function (data) {                                                                                                                                                                                                        
                //                 fnResolve();                                                                                                                                                                                                                
                //                 sap.m.MessageBox.success('Grupo alterado com sucesso');                                                                                                                                                                     
                //                 that.getView().byId('br.com.trescoracoes.aprovctaspagar::sap.suite.ui.generic.template.ObjectPage.view.Details::ContasPagar--Documentos::analyticalTable').getModel().refresh(true)                                         
                //                 // that.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                             
                //                 if (oTable.getBinding("items").getLength() == 0)                                                                                                                                                                            
                //                     window.history.go(-1);                                                                                                                                                                                                  
                //             });                                                                                                                                                                                                                             
                //         }                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                //     });                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                // }                                                                                                                                                                                                                                           
                // var mParameters = {                                                                                                                                                                                                                         
                //     //sActionLabel: this.getView().getModel().getProperty("/#EmissaoType/UseAvailableCheckBox/@sap:label"),                                                                                                                                 
                //     dataloss: false                                                                                                                                                                                                                         
                // };                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                // this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
        };                                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               