sap.ui.define(                                                                                                                                                                                                                                                 
    ["sap/m/PDFViewer"],                                                                                                                                                                                                                                       
    function (PDFViewer) {                                                                                                                                                                                                                                     
        "use strict";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        return sap.ui.controller("br.com.trescoracoes.emissaocomprovantepagto.ext.controller.ListReportExt", {                                                                                                                                                 
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Comprovante PDF                                                                                                                                                                                                                                    
            =================================================================== */                                                                                                                                                                             
            downloadPdf: function (oEvent) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                               
                // Recupera a linha selecionada&nbsp;                                                                                                                                                                                                          
                var oSelection = this.extensionAPI.getSelectedContexts();                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                if (oSelection.length > 0) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    var vComprovante = oSelection.reduce(function (sText, oSelectedContext) {                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        return oSelectedContext.getObject();                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    }, "");                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                               
                // Chama PDF Viewer com o link da URL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                          
                var sServiceURL = "/sap/opu/odata/SAP/ZFI_COMPROV_PAGTO_SRV/";                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                var sSource = sServiceURL + "PdfFileSet(Empresa='" + vComprovante.Empresa + "',Fornecedor='" + vComprovante.Fornecedor + "',Fatura='" + vComprovante.Fatura +                                                                                  
                "',DocContabAuxiliar='" + vComprovante.DocContabAuxiliar + "',ExercicioCompensacao='" + vComprovante.ExercicioCompensacao +                                                                                                                    
                "',BancoEmpresa='" + vComprovante.BancoEmpresa + "',FormaPagto='" + vComprovante.FormaPagto + "')/$value";                                                                                                                                     
                                                                                                                                                                                                                                                               
                var opdfViewer = new PDFViewer();                                                                                                                                                                                                              
                this.getView().addDependent(opdfViewer);                                                                                                                                                                                                       
                opdfViewer.setSource(sSource);                                                                                                                                                                                                                 
                opdfViewer.setTitle("Comprovante de Pagamento");                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                // Permite o download direto do PDF, sem pré-visualização no PDF Viewer                                                                                                                                                                        
                opdfViewer.downloadPDF();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Emitir Comprovante                                                                                                                                                                                                                                 
            =================================================================== */                                                                                                                                                                             
            showPdfWindow: function (oEvent) {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                // Recupera a linha selecionada&nbsp;                                                                                                                                                                                                          
                var oSelection = this.extensionAPI.getSelectedContexts();                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                if (oSelection.length > 0) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    var vComprovante = oSelection.reduce(function (sText, oSelectedContext) {                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        return oSelectedContext.getObject();                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    }, "");                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                //Chama serviço gateway (SEGW)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                 
                var vServiceUrl = "/sap/opu/odata/SAP/ZFI_COMPROV_PAGTO_SRV/";                                                                                                                                                                                 
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var vServiceUrlRead =                                                                                                                                                                                                                          
                    "PdfBrowserSet(Empresa='" + vComprovante.Empresa + "',Fornecedor='" + vComprovante.Fornecedor + "',Fatura='" + vComprovante.Fatura +                                                                                                       
                    "',DocContabAuxiliar='" + vComprovante.DocContabAuxiliar + "',ExercicioCompensacao='" + vComprovante.ExercicioCompensacao +                                                                                                                
                    "',BancoEmpresa='" + vComprovante.BancoEmpresa + "',FormaPagto='" + vComprovante.FormaPagto + "')";                                                                                                                                        
                                                                                                                                                                                                                                                               
                oModel.read(vServiceUrlRead, null, null, true,                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    /* ===================================================================&nbsp;                                                                                                                                                               
                    Em caso de sucesso, Chama PDF em nova janela&nbsp;                                                                                                                                                                                         
                    =================================================================== */                                                                                                                                                                     
                    function (oData) {                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        window.open(oData.Url);                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    },                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    function (error) {                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        alert('Falha ao gerar o arquivo');                                                                                                                                                                                                     
                    });                                                                                                                                                                                                                                        
            }                                                                                                                                                                                                                                                  
        });                                                                                                                                                                                                                                                    
    });                                                                                                                                                                                                                                                        