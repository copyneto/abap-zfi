sap.ui.define(["sap/ui/export/Spreadsheet","sap/ui/export/library"],function(e,t){"use strict";return sap.ui.controller("br.com.trescoracoes.basedecalculo.ext.controller.ObjectPageExt",{onActionUploadFile:function(e){var t=this;var r=new sap.m.Dialog({co+
ntentWidth:"300px",resizable:true,type:"Message"});r.setTitle("Carregar arquivo Excel");var p="/sap/opu/odata/sap/ZFI_BASE_CALCULO_SRV/";var a=new sap.ui.model.odata.ODataModel(p,false);var o=p+"UploadSet";var s=new sap.ui.unified.FileUploader({width:"10+
0%",fileType:["xlsx","xls","csv"],typeMissmatch:this.handleTypeMissmatch});s.setName("Simple Uploader");s.setUploadUrl(o);s.setSendXHR(true);s.setUseMultipart(false);s.setUploadOnChange(false);var n=new sap.ui.unified.FileUploaderParameter({name:"x-csrf-+
token",value:a.getSecurityToken()});s.insertHeaderParameter(n);var l=new sap.m.Button({text:"Upload",type:"Accept",press:function(){var e=s.getFocusDomRef();var p=e.files[0];if(s.getValue()===""){sap.m.MessageToast.show("Favor selecionar um arquivo");ret+
urn}var a=new sap.ui.unified.FileUploaderParameter({name:"Content-Type",value:p.type});s.insertHeaderParameter(a);s.insertHeaderParameter(new sap.ui.unified.FileUploaderParameter({name:"SLUG",value:s.getValue()}));var o=function(e){return new Promise(fun+
ction(e,p){s.attachUploadComplete(function(a){r.close();r.destroy();if(a.mParameters.status=="200"||a.mParameters.status=="201"||a.mParameters.status=="204"){e()}else{t.showLog(a.mParameters.responseRaw);p()}t.templateBaseExtension.getExtensionAPI().refr+
eshTable();debugger}.bind(this));s.upload()}.bind(this))}.bind(this);var n={sActionLabel:"Upload de Arquivo",dataloss:false};this.extensionAPI.securedExecution(o,n)}.bind(this)});var i=new sap.m.Button({text:"Cancelar",type:"Reject",press:function(){r.cl+
ose();r.destroy();this.getView().removeAllDependents()}.bind(this)});r.addContent(s);r.setBeginButton(i);r.setEndButton(l);r.open()},handleTypeMissmatch:function(e){var t=e.getSource().getFileType();jQuery.each(t,function(e,r){t[e]="*."+r});var r=t.join(+
", ");sap.m.MessageToast.show("Tipo de arquivo *."+e.getParameter("fileType")+" nao ? suportado. Escolha um dos tipos a seguir: "+r)},onActionExportExcel:function(r){var p="/sap/opu/odata/sap/ZUI_O2_BASE_CALC_EXPORT";var a=new sap.ui.model.odata.ODataMod+
el(p,false);var o=r.getSource().getBindingContext().getObject();var s=[new sap.ui.model.Filter("Contrato",sap.ui.model.FilterOperator.EQ,o.Contrato)];var n=[];n.push({label:"Contrato",property:"Contrato",type:t.EdmType.String});n.push({label:"Aditivo do +
Contrato",property:"Aditivo",type:t.EdmType.String});n.push({label:"Tipo de Comparação",property:"TipoComparacao",type:t.EdmType.String});n.push({label:"Periodo Avalida",property:"PeridAvaliado",type:t.EdmType.String});n.push({label:"Ciclo",property:"Cic+
lo",type:t.EdmType.String});n.push({label:"Exercicio Anterior",property:"Exerc_anter",type:t.EdmType.String});n.push({label:"Exercicio Atual",property:"Exerc_atual",type:t.EdmType.String});n.push({label:"Documento",property:"Belnr",type:t.EdmType.String}+
);n.push({label:"Empresa",property:"Bukrs",type:t.EdmType.String});n.push({label:"Exercicio",property:"Gjahr",type:t.EdmType.String});n.push({label:"Item",property:"Buzei",type:t.EdmType.String});n.push({label:"Ajuste Anual",property:"AjusteAnual",type:t+
.EdmType.String});n.push({label:"Divisão",property:"Gsber",type:t.EdmType.String});n.push({label:"Familia",property:"FamiliaCl",type:t.EdmType.String});n.push({label:"Chave Manual",property:"ChaveManual",type:t.EdmType.String});n.push({label:"Valor",prop+
erty:"Wrbtr",type:t.EdmType.Currency});n.push({label:"Chave",property:"Bschl",type:t.EdmType.String});n.push({label:"Tipo Doc",property:"Blart",type:t.EdmType.String});n.push({label:"Atribuição",property:"Zuonr",type:t.EdmType.String});n.push({label:"Cli+
ente",property:"Kunnr",type:t.EdmType.String});n.push({label:"Forma de Pagto",property:"Zlsch",type:t.EdmType.String});n.push({label:"Texto",property:"Sgtxt",type:t.EdmType.String});n.push({label:"Vencimento",property:"Netdt",type:t.EdmType.String});n.pu+
sh({label:"Ref",property:"Xblnr",type:t.EdmType.String});n.push({label:"Data Lanç",property:"Budat",type:t.EdmType.String});n.push({label:"Data Doc",property:"Bldat",type:t.EdmType.String});n.push({label:"DocCompens",property:"Augbl",type:t.EdmType.Strin+
g});n.push({label:"Compensação",property:"Augdt",type:t.EdmType.String});n.push({label:"Doc.faturamento",property:"Vbeln",type:t.EdmType.String});n.push({label:"Item Fat",property:"Posnr",type:t.EdmType.String});n.push({label:"Documento referência",prope+
rty:"Vgbel",type:t.EdmType.String});n.push({label:"Canal distrib.",property:"Vtweg",type:t.EdmType.String});n.push({label:"Setor",property:"Spart",type:t.EdmType.String});n.push({label:"Reg.vendas",property:"Bzirk",type:t.EdmType.String});n.push({label:"+
Clas. CNPJ",property:"Katr2",type:t.EdmType.String});n.push({label:"Família (CL)",property:"Wwmt1",type:t.EdmType.String});n.push({label:"Centro de lucro",property:"Prctr",type:t.EdmType.String});n.push({label:"Tp Entrega",property:"TipoEntrega",type:t.E+
dmType.String});n.push({label:"ChaveRef1",property:"Xref1Hd",type:t.EdmType.String});n.push({label:"Status DDE",property:"StatusDde",type:t.EdmType.String});n.push({label:"Tipo Apuracao",property:"TipoApuracao",type:t.EdmType.String});n.push({label:"Tipo+
 Apura Imposto",property:"TipoApImposto",type:t.EdmType.String});n.push({label:"Tipo Imposto",property:"TipoImposto",type:t.EdmType.String});n.push({label:"Impostos Desconsid",property:"ImpostDesconsid",type:t.EdmType.String});n.push({label:"MontLiqImpos+
to",property:"MontLiqTax",type:t.EdmType.Currency});n.push({label:"MontValido",property:"MontValido",type:t.EdmType.Currency});n.push({label:"Tipo Desconto",property:"TipoDesconto",type:t.EdmType.String});n.push({label:"Cond Desconto",property:"CondDesco+
nto",type:t.EdmType.String});n.push({label:"Centro de Custos",property:"Kostl",type:t.EdmType.String});n.push({label:"MontBonus",property:"MontBonus",type:t.EdmType.Currency});n.push({label:"Bonus Calculado",property:"BonusCalculado",type:t.EdmType.Curre+
ncy});n.push({label:"Obs Ajuste",property:"ObsAjuste",type:t.EdmType.String});a.read("/ZC_FI_BASE_DE_CALCULO",{filters:s,success:function(t){for(let e=0;e<t.results.length;e++){var r=t.results[e];r.Wrbtr=new Intl.NumberFormat("pt-BR",{style:"currency",cu+
rrency:"BRL"}).format(r.Wrbtr);r.MontLiqTax=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.MontLiqTax);r.MontValido=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.MontValido);r.MontBonus=new Intl.Numb+
erFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.MontBonus);r.BonusCalculado=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.BonusCalculado);if(r.Netdt!=null){r.Netdt=new Intl.DateTimeFormat("pt-BR").format(r.Netdt.D+
ate)}if(r.Budat!=null){r.Budat=new Intl.DateTimeFormat("pt-BR").format(r.Budat.Date)}if(r.Bldat!=null){r.Bldat=new Intl.DateTimeFormat("pt-BR").format(r.Bldat.Date)}if(r.Augdt!=null){r.Augdt=new Intl.DateTimeFormat("pt-BR").format(r.Augdt.Date)}}var p={w+
orkbook:{columns:n},dataSource:t.results,fileName:o.Countid+".xlsx"};var a=new e(p);a.build().finally(function(){a.destroy()})}.bind(this),error:function(e){alert("Falha ao extrair os dados")}.bind(this)})},showLog:function(e){let t=[];for(const r of e.m+
atchAll(/(?:<message>(.*?)<[/]message>)/gm)){t.push(r[1])}let r=[];for(const t of e.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)){switch(t[1]){case"error":r.push(sap.ui.core.MessageType.Error);break;case"info":r.push(sap.ui.core.MessageType.Information+
);break;case"success":r.push(sap.ui.core.MessageType.Success);break;case"warning":r.push(sap.ui.core.MessageType.Warning);break;default:r.push(sap.ui.core.MessageType.None);break}}for(let e=0;e<t.length;e++){if(t[e]=="Ocorreu uma exceção"){continue}sap.u+
i.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({message:t[e],persistent:true,type:r[e]}))}}})});                                                                                                                                  