sap.ui.define([                                                                                                                                                                                                                                                
    "sap/ui/export/Spreadsheet",                                                                                                                                                                                                                               
    "sap/ui/export/library"                                                                                                                                                                                                                                    
],                                                                                                                                                                                                                                                             
    function (spreadsheet, library) {                                                                                                                                                                                                                          
        "use strict";                                                                                                                                                                                                                                          
        return sap.ui.controller("br.com.trescoracoes.basedecalculo.ext.controller.ObjectPageExt", {                                                                                                                                                           
            onActionUploadFile: function (oEvent) {                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var that = this;                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                 Cria Dialogo dinamico (pop-up)                                                                                                                                                                                                                
                =================================================================== */                                                                                                                                                                         
                var oUploadDialog = new sap.m.Dialog({                                                                                                                                                                                                         
                    contentWidth: "300px",                                                                                                                                                                                                                     
                    resizable: true,                                                                                                                                                                                                                           
                    type: "Message"                                                                                                                                                                                                                            
                });                                                                                                                                                                                                                                            
                oUploadDialog.setTitle("Carregar arquivo Excel");                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Define o servico gateway que ser chamado                                                                                                                                                                                                       
                =================================================================== */                                                                                                                                                                         
                var sServiceUrl = "/sap/opu/odata/sap/ZFI_BASE_CALCULO_SRV/";                                                                                                                                                                                  
                var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, false);                                                                                                                                                                            
                var sSource = sServiceUrl + "UploadSet";                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Gateway para processar logs                                                                                                                                                                                                              
                =================================================================== */                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Prepara o responsavel pela carga do arquivo                                                                                                                                                                                                    
                =================================================================== */                                                                                                                                                                         
                var oFileUploader = new sap.ui.unified.FileUploader({                                                                                                                                                                                          
                    width: "100%",                                                                                                                                                                                                                             
                    fileType: ["xlsx", "xls", "csv"],                                                                                                                                                                                                          
                    typeMissmatch: this.handleTypeMissmatch,                                                                                                                                                                                                   
                    /** Deixa de existir -> vai lá pra baixo&nbsp;                                                                                                                                                                                             
                    uploadComplete: function (oEvent) {                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        // Atualiza tabela do relatorio apos carga                                                                                                                                                                                             
                        var sId = this.oView.sId + '--responsiveTable';                                                                                                                                                                                        
                        var oTable = this.byId(sId);                                                                                                                                                                                                           
                        oTable.getModel().refresh(true);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        // Verifica o retorno da mensagem                                                                                                                                                                                                      
                        if (oEvent.mParameters.status == '200' ||                                                                                                                                                                                              
                            oEvent.mParameters.status == '201' ||                                                                                                                                                                                              
                            oEvent.mParameters.status == '204') {                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            alert("Carga realizada com sucesso.");                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                        else {                                                                                                                                                                                                                                 
                            //alert("Return Code: " + oEvent.mParameters.response, "Response", "Response");                                                                                                                                                    
                            this.showLog(oEvent.mParameters.responseRaw);                                                                                                                                                                                      
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }.bind(this)*/                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
               Define parametros                                                                                                                                                                                                                               
               =================================================================== */                                                                                                                                                                          
                oFileUploader.setName("Simple Uploader");                                                                                                                                                                                                      
                oFileUploader.setUploadUrl(sSource);                                                                                                                                                                                                           
                oFileUploader.setSendXHR(true);                                                                                                                                                                                                                
                oFileUploader.setUseMultipart(false);                                                                                                                                                                                                          
                oFileUploader.setUploadOnChange(false);                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                var oToken = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                                        
                    name: "x-csrf-token",                                                                                                                                                                                                                      
                    value: oModel.getSecurityToken()                                                                                                                                                                                                           
                });                                                                                                                                                                                                                                            
                oFileUploader.insertHeaderParameter(oToken);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria botao para a carga do arquivo                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var oTriggerButton = new sap.m.Button({                                                                                                                                                                                                        
                    text: 'Upload',                                                                                                                                                                                                                            
                    type: 'Accept',                                                                                                                                                                                                                            
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        // Verifica se arquivo foi informado                                                                                                                                                                                                   
                        var domRef = oFileUploader.getFocusDomRef();                                                                                                                                                                                           
                        var file = domRef.files[0];                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                        if (oFileUploader.getValue() === '') {                                                                                                                                                                                                 
                            sap.m.MessageToast.show("Favor selecionar um arquivo");                                                                                                                                                                            
                            return;                                                                                                                                                                                                                            
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var oContentType = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                          
                            name: "Content-Type",                                                                                                                                                                                                              
                            value: file.type                                                                                                                                                                                                                   
                        });                                                                                                                                                                                                                                    
                        oFileUploader.insertHeaderParameter(oContentType);                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        oFileUploader.insertHeaderParameter(new sap.ui.unified.FileUploaderParameter({                                                                                                                                                         
                            name: "SLUG",                                                                                                                                                                                                                      
                            value: oFileUploader.getValue()                                                                                                                                                                                                    
                        }));                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        var fnFunctionTeste = function (oEvent) {                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                oFileUploader.attachUploadComplete(                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                    function (oEvent) {                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                                        /* O upload precisa vim pra k */                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                        // Atualiza tabela do relatorio apos carga                                                                                                                                                                             
                                        //var sId = that.oView.sId + '--responsiveTable';                                                                                                                                                                      
                                        //var oTable = that.byId(sId);                                                                                                                                                                                         
                                        //oTable.getModel().refresh(true);                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                        oUploadDialog.close();                                                                                                                                                                                                 
                                        oUploadDialog.destroy();                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                        // Verifica o retorno da mensagem                                                                                                                                                                                      
                                        if (oEvent.mParameters.status == '200' ||                                                                                                                                                                              
                                            oEvent.mParameters.status == '201' ||                                                                                                                                                                              
                                            oEvent.mParameters.status == '204') {                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                            showSuccessMessage();                                                                                                                                                                                              
                                            //alert("Carga realizada com sucesso.");                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                        }                                                                                                                                                                                                                      
                                        else {                                                                                                                                                                                                                 
                                            that.showLog(oEvent.mParameters.responseRaw);                                                                                                                                                                      
                                            showErrorMessage();                                                                                                                                                                                                
                                        }                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                                        that.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                           
                                        debugger;                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                    }.bind(this)                                                                                                                                                                                                               
                                );                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                oFileUploader.upload();                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                            }.bind(this))                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        }.bind(this)                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        var mParameters = {                                                                                                                                                                                                                    
                            sActionLabel: 'Upload de Arquivo',                                                                                                                                                                                                 
                            dataloss: false                                                                                                                                                                                                                    
                        };                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        this.extensionAPI.securedExecution(fnFunctionTeste, mParameters);                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria bot�o de cancelar                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var oCancelButton = new sap.m.Button({                                                                                                                                                                                                         
                    text: 'Cancelar',                                                                                                                                                                                                                          
                    type: 'Reject',                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    press: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oUploadDialog.close();                                                                                                                                                                                                                 
                        oUploadDialog.destroy();                                                                                                                                                                                                               
                        this.getView().removeAllDependents();                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama dialogo com a logica de carga&nbsp;                                                                                                                                                                                                      
                =================================================================== */                                                                                                                                                                         
                oUploadDialog.addContent(oFileUploader);                                                                                                                                                                                                       
                oUploadDialog.setBeginButton(oCancelButton);                                                                                                                                                                                                   
                oUploadDialog.setEndButton(oTriggerButton);                                                                                                                                                                                                    
                oUploadDialog.open();                                                                                                                                                                                                                          
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            handleTypeMissmatch: function (oEvent) {                                                                                                                                                                                                           
                var aFileTypes = oEvent.getSource().getFileType();                                                                                                                                                                                             
                jQuery.each(aFileTypes, function (key, value) { aFileTypes[key] = "*." + value; });                                                                                                                                                            
                var sSupportedFileTypes = aFileTypes.join(", ");                                                                                                                                                                                               
                sap.m.MessageToast.show("Tipo de arquivo *." + oEvent.getParameter("fileType") +                                                                                                                                                               
                    " nao ? suportado. Escolha um dos tipos a seguir: " +                                                                                                                                                                                      
                    sSupportedFileTypes);                                                                                                                                                                                                                      
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionExportExcel: function (oEvent) {                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura Serviço OData onde será extraído os dados                                                                                                                                                                                            
                =================================================================== */                                                                                                                                                                         
                var vServiceUrl = "/sap/opu/odata/sap/ZUI_O2_BASE_CALC_EXPORT";                                                                                                                                                                                
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Monta filtro com a linha selecionada&nbsp;                                                                                                                                                                                                     
                =================================================================== */                                                                                                                                                                         
                var sObject = oEvent.getSource().getBindingContext().getObject();                                                                                                                                                                              
                var aFilters = [new sap.ui.model.Filter('Contrato', sap.ui.model.FilterOperator.EQ, sObject.Contrato)];                                                                                                                                        
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura colunas do excel                                                                                                                                                                                                                     
                =================================================================== */                                                                                                                                                                         
                var aCols = [];                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Contrato',                                                                                                                                                                                                                         
                    property: 'Contrato',                                                                                                                                                                                                                      
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Aditivo do Contrato',                                                                                                                                                                                                              
                    property: 'Aditivo',                                                                                                                                                                                                                       
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Tipo de Comparação',                                                                                                                                                                                                               
                    property: 'TipoComparacao',                                                                                                                                                                                                                
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Periodo Avalida',                                                                                                                                                                                                                  
                    property: 'PeridAvaliado',                                                                                                                                                                                                                 
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Ciclo',                                                                                                                                                                                                                            
                    property: 'Ciclo',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Exercicio Anterior',                                                                                                                                                                                                               
                    property: 'Exerc_anter',                                                                                                                                                                                                                   
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Exercicio Atual',                                                                                                                                                                                                                  
                    property: 'Exerc_atual',                                                                                                                                                                                                                   
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Documento',                                                                                                                                                                                                                        
                    property: 'Belnr',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Empresa',                                                                                                                                                                                                                          
                    property: 'Bukrs',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Exercicio',                                                                                                                                                                                                                        
                    property: 'Gjahr',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Item',                                                                                                                                                                                                                             
                    property: 'Buzei',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Ajuste Anual',                                                                                                                                                                                                                     
                    property: 'AjusteAnual',                                                                                                                                                                                                                   
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Divisão',                                                                                                                                                                                                                          
                    property: 'Gsber',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Familia',                                                                                                                                                                                                                          
                    property: 'FamiliaCl',                                                                                                                                                                                                                     
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Chave Manual',                                                                                                                                                                                                                     
                    property: 'ChaveManual',                                                                                                                                                                                                                   
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Valor',                                                                                                                                                                                                                            
                    property: 'Wrbtr',                                                                                                                                                                                                                         
                    type: library.EdmType.Currency                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Chave',                                                                                                                                                                                                                            
                    property: 'Bschl',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Tipo Doc',                                                                                                                                                                                                                         
                    property: 'Blart',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Atribuição',                                                                                                                                                                                                                       
                    property: 'Zuonr',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Cliente',                                                                                                                                                                                                                          
                    property: 'Kunnr',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Forma de Pagto',                                                                                                                                                                                                                   
                    property: 'Zlsch',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Texto',                                                                                                                                                                                                                            
                    property: 'Sgtxt',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Vencimento',                                                                                                                                                                                                                       
                    property: 'Netdt',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Ref',                                                                                                                                                                                                                              
                    property: 'Xblnr',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Data Lanç',                                                                                                                                                                                                                        
                    property: 'Budat',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Data Doc',                                                                                                                                                                                                                         
                    property: 'Bldat',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'DocCompens',                                                                                                                                                                                                                       
                    property: 'Augbl',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Compensação',                                                                                                                                                                                                                      
                    property: 'Augdt',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Doc.faturamento',                                                                                                                                                                                                                  
                    property: 'Vbeln',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Item Fat',                                                                                                                                                                                                                         
                    property: 'Posnr',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Documento referência',                                                                                                                                                                                                             
                    property: 'Vgbel',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Canal distrib.',                                                                                                                                                                                                                   
                    property: 'Vtweg',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Setor',                                                                                                                                                                                                                            
                    property: 'Spart',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Reg.vendas',                                                                                                                                                                                                                       
                    property: 'Bzirk',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Clas. CNPJ',                                                                                                                                                                                                                       
                    property: 'Katr2',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Família (CL)',                                                                                                                                                                                                                     
                    property: 'Wwmt1',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Centro de lucro',                                                                                                                                                                                                                  
                    property: 'Prctr',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Tp Entrega',                                                                                                                                                                                                                       
                    property: 'TipoEntrega',                                                                                                                                                                                                                   
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'ChaveRef1',                                                                                                                                                                                                                        
                    property: 'Xref1Hd',                                                                                                                                                                                                                       
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Status DDE',                                                                                                                                                                                                                       
                    property: 'StatusDde',                                                                                                                                                                                                                     
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Tipo Apuracao',                                                                                                                                                                                                                    
                    property: 'TipoApuracao',                                                                                                                                                                                                                  
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Tipo Apura Imposto',                                                                                                                                                                                                               
                    property: 'TipoApImposto',                                                                                                                                                                                                                 
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Tipo Imposto',                                                                                                                                                                                                                     
                    property: 'TipoImposto',                                                                                                                                                                                                                   
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Impostos Desconsid',                                                                                                                                                                                                               
                    property: 'ImpostDesconsid',                                                                                                                                                                                                               
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'MontLiqImposto',                                                                                                                                                                                                                   
                    property: 'MontLiqTax',                                                                                                                                                                                                                    
                    type: library.EdmType.Currency                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'MontValido',                                                                                                                                                                                                                       
                    property: 'MontValido',                                                                                                                                                                                                                    
                    type: library.EdmType.Currency                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Tipo Desconto',                                                                                                                                                                                                                    
                    property: 'TipoDesconto',                                                                                                                                                                                                                  
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Cond Desconto',                                                                                                                                                                                                                    
                    property: 'CondDesconto',                                                                                                                                                                                                                  
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Centro de Custos',                                                                                                                                                                                                                 
                    property: 'Kostl',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'MontBonus',                                                                                                                                                                                                                        
                    property: 'MontBonus',                                                                                                                                                                                                                     
                    type: library.EdmType.Currency                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Bonus Calculado',                                                                                                                                                                                                                  
                    property: 'BonusCalculado',                                                                                                                                                                                                                
                    type: library.EdmType.Currency                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Obs Ajuste',                                                                                                                                                                                                                       
                    property: 'ObsAjuste',                                                                                                                                                                                                                     
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Serviço                                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                oModel.read("/ZC_FI_BASE_DE_CALCULO", {                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    filters: aFilters,                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    success: function (oData) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        for (let i = 0; i < oData.results.length; i++) {                                                                                                                                                                                       
                            var oObject = oData.results[i];                                                                                                                                                                                                    
                            oObject.Wrbtr = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(oObject.Wrbtr);                                                                                                                      
                            oObject.MontLiqTax = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(oObject.MontLiqTax);                                                                                                            
                            oObject.MontValido = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(oObject.MontValido);                                                                                                            
                            oObject.MontBonus = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(oObject.MontBonus);                                                                                                              
                            oObject.BonusCalculado = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(oObject.BonusCalculado);                                                                                                    
                                                                                                                                                                                                                                                               
                            if (oObject.Netdt != null) {                                                                                                                                                                                                       
                                oObject.Netdt = new Intl.DateTimeFormat('pt-BR').format(oObject.Netdt.Date);                                                                                                                                                   
                            }                                                                                                                                                                                                                                  
                            if (oObject.Budat != null) {                                                                                                                                                                                                       
                                oObject.Budat = new Intl.DateTimeFormat('pt-BR').format(oObject.Budat.Date);                                                                                                                                                   
                            }                                                                                                                                                                                                                                  
                            if (oObject.Bldat != null) {                                                                                                                                                                                                       
                                oObject.Bldat = new Intl.DateTimeFormat('pt-BR').format(oObject.Bldat.Date);                                                                                                                                                   
                            }                                                                                                                                                                                                                                  
                            if (oObject.Augdt != null) {                                                                                                                                                                                                       
                                oObject.Augdt = new Intl.DateTimeFormat('pt-BR').format(oObject.Augdt.Date);                                                                                                                                                   
                            }                                                                                                                                                                                                                                  
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        // Configurações do arquivo                                                                                                                                                                                                            
                        var oSettings = {                                                                                                                                                                                                                      
                            workbook: {                                                                                                                                                                                                                        
                                columns: aCols,                                                                                                                                                                                                                
                            },                                                                                                                                                                                                                                 
                            dataSource: oData.results,                                                                                                                                                                                                         
                            fileName: sObject.Countid + '.xlsx'                                                                                                                                                                                                
                        };                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        // Baixar arquivo excel                                                                                                                                                                                                                
                        var oSheet = new spreadsheet(oSettings);                                                                                                                                                                                               
                        oSheet.build().finally(function () {                                                                                                                                                                                                   
                            oSheet.destroy();                                                                                                                                                                                                                  
                        });                                                                                                                                                                                                                                    
                    }.bind(this),                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    error: function (oError) {                                                                                                                                                                                                                 
                        alert('Falha ao extrair os dados');                                                                                                                                                                                                    
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            showLog: function (sMessage) {                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                // Recupera texto da mensagem                                                                                                                                                                                                                  
                let aMessage = [];                                                                                                                                                                                                                             
                for (const res of sMessage.matchAll(/(?:<message>(.*?)<[/]message>)/gm)) {                                                                                                                                                                     
                    aMessage.push(res[1]);                                                                                                                                                                                                                     
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                // Recupera o tipo da mensagem                                                                                                                                                                                                                 
                let aSeverity = [];                                                                                                                                                                                                                            
                for (const res of sMessage.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)) {                                                                                                                                                                   
                    switch (res[1]) {                                                                                                                                                                                                                          
                        case "error":                                                                                                                                                                                                                          
                            aSeverity.push(sap.ui.core.MessageType.Error);                                                                                                                                                                                     
                            break;                                                                                                                                                                                                                             
                        case "info":                                                                                                                                                                                                                           
                            aSeverity.push(sap.ui.core.MessageType.Information);                                                                                                                                                                               
                            break;                                                                                                                                                                                                                             
                        case "success":                                                                                                                                                                                                                        
                            aSeverity.push(sap.ui.core.MessageType.Success);                                                                                                                                                                                   
                            break;                                                                                                                                                                                                                             
                        case "warning":                                                                                                                                                                                                                        
                            aSeverity.push(sap.ui.core.MessageType.Warning);                                                                                                                                                                                   
                            break;                                                                                                                                                                                                                             
                        default:                                                                                                                                                                                                                               
                            aSeverity.push(sap.ui.core.MessageType.None);                                                                                                                                                                                      
                            break;                                                                                                                                                                                                                             
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                // Exibe mensagem                                                                                                                                                                                                                              
                for (let i = 0; i < aMessage.length; i++) {                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    if (aMessage[i] == "Ocorreu uma exceção") {                                                                                                                                                                                                
                        continue;                                                                                                                                                                                                                              
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    //alert(aMessage[i]);                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    //MessageManager.addMessages(new sap.ui.core.message.Message({                                                                                                                                                                             
                    sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                                         
                        message: aMessage[i],                                                                                                                                                                                                                  
                        persistent: true, // create message as transition message                                                                                                                                                                              
                        type: aSeverity[i]                                                                                                                                                                                                                     
                    }));                                                                                                                                                                                                                                       
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        });                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
    });                                                                                                                                                                                                                                                        