sap.ui.define([],                                                                                                                                                                                                                                              
    function () {                                                                                                                                                                                                                                              
        "use strict";                                                                                                                                                                                                                                          
        return {                                                                                                                                                                                                                                               
            onInit: function () {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
            parseXmlToJson: function (xml) {                                                                                                                                                                                                                   
                const json = {};                                                                                                                                                                                                                               
                for (const res of xml.matchAll(/(?:<(\w*)(?:\s[^>]*)*>)((?:(?!<\1).)*)(?:<\/\1>)|<(\w*)(?:\s*)*\/>/gm)) {                                                                                                                                      
                    const key = res[1] || res[3];                                                                                                                                                                                                              
                    const value = res[2] && this.parseXmlToJson(res[2]);                                                                                                                                                                                       
                    json[key] = ((value && Object.keys(value).length) ? value : res[2]) || null;                                                                                                                                                               
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                return json;                                                                                                                                                                                                                                   
            },                                                                                                                                                                                                                                                 
            onNavegar: function (oEvent) {                                                                                                                                                                                                                     
                sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                          
                    // { target: { shellHash: "0VRF-manage" } }                                                                                                                                                                                                
                    { target: { shellHash: "logcontabilizacao-display" } }                                                                                                                                                                                     
                ])                                                                                                                                                                                                                                             
                    .done(function (aResponse) {                                                                                                                                                                                                               
                        aResponse.map(function (elem, index) {                                                                                                                                                                                                 
                            if (elem.supported === true) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                /* ===================================================================                                                                                                                                                         
                                Chama outro aplicativo                                                                                                                                                                                                         
                                =================================================================== */                                                                                                                                                         
                                var href = (sap.ushell && sap.ushell.Container && sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                              
                                    target: { semanticObject: "logcontabilizacao", action: "display" },                                                                                                                                                        
                                    params: {}                                                                                                                                                                                                                 
                                })) || "";                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                sap.m.URLHelper.redirect(href, false);                                                                                                                                                                                         
                            }                                                                                                                                                                                                                                  
                            else {                                                                                                                                                                                                                             
                                alert('Usuário sem permissão para acessar o link');                                                                                                                                                                            
                            }                                                                                                                                                                                                                                  
                        })                                                                                                                                                                                                                                     
                    })                                                                                                                                                                                                                                         
                    .fail(function () {                                                                                                                                                                                                                        
                        alert('Falha ao acessar o link');                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onSimular: function (oEvent) {                                                                                                                                                                                                                     
                // let that = this;                                                                                                                                                                                                                            
                // let oExtensionApi = this.extensionAPI;                                                                                                                                                                                                      
                // let aSelection = oExtensionApi.getSelectedContexts();                                                                                                                                                                                       
                // let oTable = sap.ui.getCore().byId('br.com.trescoracoes.contabilizacao::sap.suite.ui.generic.template.ListReport.view.ListReport::Header--GridTable')                                                                                       
                let vServiceUrl = "/sap/opu/odata/SAP/ZFI_CONTABILIZACAO_SRV/";                                                                                                                                                                                
                let oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                let vEntitySet = "SimularSet";                                                                                                                                                                                                                 
                //     let aFilters = [];                                                                                                                                                                                                                      
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Tentativa com create, change_set                                                                                                                                                                                                               
                =================================================================== */                                                                                                                                                                         
                // var data = []                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                // var oItems = new sap.ui.model.json.JSONModel([]);                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                // for (var i = 0; i < aSelection.length; i++) {                                                                                                                                                                                               
                //     data.push({                                                                                                                                                                                                                             
                //         "Identificacao": aSelection[i].getObject().Identificacao,                                                                                                                                                                           
                //         "Id": aSelection[i].getObject().Id,                                                                                                                                                                                                 
                //         "Status": aSelection[i].getObject().Status,                                                                                                                                                                                         
                //         "Empresa": aSelection[i].getObject().Empresa,                                                                                                                                                                                       
                //         "DataDocumento": new Date(),                                                                                                                                                                                                        
                //         "DataLancamento": new Date(),                                                                                                                                                                                                       
                //         "TipoDocumento": aSelection[i].getObject().TipoDocumento,                                                                                                                                                                           
                //         "Referencia": aSelection[i].getObject().Referencia,                                                                                                                                                                                 
                //         "TextCab": aSelection[i].getObject().TextCab,                                                                                                                                                                                       
                //         "TextStatus": aSelection[i].getObject().TextStatus                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                //     })                                                                                                                                                                                                                                      
                // }                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                // oItems.setData(data);                                                                                                                                                                                                                       
                // oModel.setUseBatch(false);                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                // for (var i = 0; i < aSelection.length; i++) {                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                //     let oEntry = oItems.getData()[i];                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                //     oModel.create(vEntitySet, oEntry, {                                                                                                                                                                                                     
                //         method: "POST",                                                                                                                                                                                                                     
                //         success: function (oData, oResponse) {                                                                                                                                                                                              
                //             sap.m.MessageToast.show('Verificar o App de log para os registros selecionados.');                                                                                                                                              
                //         }.bind(this),                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                //         error: function (oError) {                                                                                                                                                                                                          
                //         }.bind(this),                                                                                                                                                                                                                       
                //     })                                                                                                                                                                                                                                      
                // }                                                                                                                                                                                                                                           
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Tentativa com entity_set                                                                                                                                                                                                                       
                =================================================================== */                                                                                                                                                                         
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Monta filtro para utilizar no gateway&nbsp;                                                                                                                                                                                                    
                =================================================================== */                                                                                                                                                                         
                // for (var i = 0; i < aSelection.length; i++) {                                                                                                                                                                                               
                //     aFilters.push(                                                                                                                                                                                                                          
                //         new sap.ui.model.Filter('Identificacao', sap.ui.model.FilterOperator.EQ, aSelection[i].getObject().Identificacao)                                                                                                                   
                //     )                                                                                                                                                                                                                                       
                // }                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Entra no Gateway&nbsp;                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function (oEvent) {                                                                                                                                                                                                           
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                        oModel.read(vEntitySet, {                                                                                                                                                                                                              
                            // filters: aFilters,                                                                                                                                                                                                              
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                this.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                   
                                const hdrMessage = oResponse.headers["sap-message"];                                                                                                                                                                           
                                const hdrMessageObject = JSON.parse(JSON.stringify(hdrMessage))                                                                                                                                                                
                                const json = this.parseXmlToJson(hdrMessageObject)                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                             
                                    message: json.notification.message,                                                                                                                                                                                        
                                    // message: JSON.parse(JSON.stringify(oResponse.data.results)),                                                                                                                                                            
                                    persistent: true, // create message as transition message                                                                                                                                                                  
                                    type: sap.ui.core.MessageType.Success                                                                                                                                                                                      
                                }));                                                                                                                                                                                                                           
                                showSuccessMessage();                                                                                                                                                                                                          
                            }.bind(this),                                                                                                                                                                                                                      
                            error: function (oError) {                                                                                                                                                                                                         
                                sap.m.MessageToast.show('Existem registros com erro, não foi possivel Simular')                                                                                                                                                
                                showErrorMessage();                                                                                                                                                                                                            
                            }.bind(this),                                                                                                                                                                                                                      
                        })                                                                                                                                                                                                                                     
                    }.bind(this))                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura pop-up de mensagens                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                // this.extensionAPI.securedExecution(fnFunction,                                                                                                                                                                                              
                //     {                                                                                                                                                                                                                                       
                //         busy: {                                                                                                                                                                                                                             
                //             set: true,                                                                                                                                                                                                                      
                //             check: false                                                                                                                                                                                                                    
                //         },                                                                                                                                                                                                                                  
                //         sActionLabel: "Mensagens"                                                                                                                                                                                                           
                //     });                                                                                                                                                                                                                                     
                // var oData = this.getView().getModel().getProperty(oEvent.getSource().getBindingContext().sPath);                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Tentativa chamando a action do behavior                                                                                                                                                                                                        
                =================================================================== */                                                                                                                                                                         
                // var oBindingContext = oEvent.getSource().getBindingContext();                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                // var fnFunction = function () {                                                                                                                                                                                                              
                //     return new Promise(function (fnResolve, fnReject) {                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                //         // for (var i = 0; i < aSelection.length; i++) {                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                //             that.extensionAPI.invokeActions(                                                                                                                                                                                                
                //                 "/simular",                                                                                                                                                                                                                 
                //                 oBindingContext,                                                                                                                                                                                                            
                //                 {                                                                                                                                                                                                                           
                //                     // "Id": '005056b0-9599-1eec-ade7-29999ac36dfd',                                                                                                                                                                        
                //                     // "Identificacao": '29624'                                                                                                                                                                                             
                //                     "Id": '000000x0-0000-0xxx-xxx0-00000xx00xxx',                                                                                                                                                                           
                //                     "Identificacao": '00000'                                                                                                                                                                                                
                //                 },                                                                                                                                                                                                                          
                //             ).then(function (data) {                                                                                                                                                                                                        
                //                 fnResolve();                                                                                                                                                                                                                
                //                 that.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                
                //             });                                                                                                                                                                                                                             
                //         // }                                                                                                                                                                                                                                
                //     });                                                                                                                                                                                                                                     
                // }                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                var mParameters = {                                                                                                                                                                                                                            
                    //sActionLabel: this.getView().getModel().getProperty("/#EmissaoType/UseAvailableCheckBox/@sap:label"),                                                                                                                                    
                    dataloss: false                                                                                                                                                                                                                            
                };                                                                                                                                                                                                                                             
                this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onContabilizar: function (oEvent) {                                                                                                                                                                                                                
                let vServiceUrl = "/sap/opu/odata/SAP/ZFI_CONTABILIZACAO_SRV/";                                                                                                                                                                                
                let oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                let vEntitySet = "ContabilizacaoSet";                                                                                                                                                                                                          
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Entra no Gateway&nbsp;                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function (oEvent) {                                                                                                                                                                                                           
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                        oModel.read(vEntitySet, {                                                                                                                                                                                                              
                            // filters: aFilters,                                                                                                                                                                                                              
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                this.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                   
                                const hdrMessage = oResponse.headers["sap-message"];                                                                                                                                                                           
                                const hdrMessageObject = JSON.parse(JSON.stringify(hdrMessage))                                                                                                                                                                
                                const json = this.parseXmlToJson(hdrMessageObject)                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                             
                                    message: json.notification.message,                                                                                                                                                                                        
                                    // message: JSON.parse(JSON.stringify(oResponse.data.results)),                                                                                                                                                            
                                    persistent: true, // create message as transition message                                                                                                                                                                  
                                    type: sap.ui.core.MessageType.Success                                                                                                                                                                                      
                                }));                                                                                                                                                                                                                           
                                showSuccessMessage();                                                                                                                                                                                                          
                            }.bind(this),                                                                                                                                                                                                                      
                            error: function (oError) {                                                                                                                                                                                                         
                                sap.m.MessageToast.show('Existem registros com erro, não foi possivel Contabilizar')                                                                                                                                           
                                showErrorMessage();                                                                                                                                                                                                            
                            }.bind(this),                                                                                                                                                                                                                      
                        })                                                                                                                                                                                                                                     
                    }.bind(this))                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                var mParameters = {                                                                                                                                                                                                                            
                    //sActionLabel: this.getView().getModel().getProperty("/#EmissaoType/UseAvailableCheckBox/@sap:label"),                                                                                                                                    
                    dataloss: false                                                                                                                                                                                                                            
                };                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                if (!this.oApproveDialog) {                                                                                                                                                                                                                    
                    this.oApproveDialog = new sap.m.Dialog({                                                                                                                                                                                                   
                        type: sap.m.DialogType.Message,                                                                                                                                                                                                        
                        title: "Confirmação",                                                                                                                                                                                                                  
                        content: new sap.m.Text({ text: "Contabilizar todos os registros?" }),                                                                                                                                                                 
                        beginButton: new sap.m.Button({                                                                                                                                                                                                        
                            type: sap.m.ButtonType.Emphasized,                                                                                                                                                                                                 
                            text: "Contabilizar",                                                                                                                                                                                                              
                            press: function () {                                                                                                                                                                                                               
                                this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                   
                                this.oApproveDialog.close();                                                                                                                                                                                                   
                                this.oApproveDialog.destroy();                                                                                                                                                                                                 
                                this.oApproveDialog = null                                                                                                                                                                                                     
                            }.bind(this)                                                                                                                                                                                                                       
                        }),                                                                                                                                                                                                                                    
                        endButton: new sap.m.Button({                                                                                                                                                                                                          
                            text: "Cancelar",                                                                                                                                                                                                                  
                            press: function () {                                                                                                                                                                                                               
                                this.oApproveDialog.close();                                                                                                                                                                                                   
                                this.oApproveDialog.destroy();                                                                                                                                                                                                 
                                this.oApproveDialog = null                                                                                                                                                                                                     
                            }.bind(this)                                                                                                                                                                                                                       
                        })                                                                                                                                                                                                                                     
                    });                                                                                                                                                                                                                                        
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                this.oApproveDialog.open();                                                                                                                                                                                                                    
            },                                                                                                                                                                                                                                                 
            onEliminar: function (oEvent) {                                                                                                                                                                                                                    
                let vServiceUrl = "/sap/opu/odata/SAP/ZFI_CONTABILIZACAO_SRV/";                                                                                                                                                                                
                let oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                let vEntitySet = "EliminarSet";                                                                                                                                                                                                                
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Busca os filtros da tela                                                                                                                                                                                                                       
                =================================================================== */                                                                                                                                                                         
                let oFilters = this.getView().byId("listReportFilter").getFilters();                                                                                                                                                                           
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Entra no Gateway&nbsp;                                                                                                                                                                                                                         
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function (oEvent) {                                                                                                                                                                                                           
                    return new Promise(function (showSuccessMessage, showErrorMessage) {                                                                                                                                                                       
                        oModel.read(vEntitySet, {                                                                                                                                                                                                              
                            filters: oFilters,                                                                                                                                                                                                                 
                            success: function (oData, oResponse) {                                                                                                                                                                                             
                                this.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                   
                                const hdrMessage = oResponse.headers["sap-message"];                                                                                                                                                                           
                                const hdrMessageObject = JSON.parse(JSON.stringify(hdrMessage))                                                                                                                                                                
                                const json = this.parseXmlToJson(hdrMessageObject)                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({                                                                                                                                             
                                    message: json.notification.message,                                                                                                                                                                                        
                                    // message: JSON.parse(JSON.stringify(oResponse.data.results)),                                                                                                                                                            
                                    persistent: true, // create message as transition message                                                                                                                                                                  
                                    type: sap.ui.core.MessageType.Success                                                                                                                                                                                      
                                }));                                                                                                                                                                                                                           
                                showSuccessMessage();                                                                                                                                                                                                          
                            }.bind(this),                                                                                                                                                                                                                      
                            error: function (oError) {                                                                                                                                                                                                         
                                sap.m.MessageToast.show('Erro ao tentar eliminar registros')                                                                                                                                                                   
                                showErrorMessage();                                                                                                                                                                                                            
                            }.bind(this),                                                                                                                                                                                                                      
                        })                                                                                                                                                                                                                                     
                    }.bind(this))                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                var mParameters = {                                                                                                                                                                                                                            
                    //sActionLabel: this.getView().getModel().getProperty("/#EmissaoType/UseAvailableCheckBox/@sap:label"),                                                                                                                                    
                    dataloss: false                                                                                                                                                                                                                            
                };                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                if (!this.oApproveDialog) {                                                                                                                                                                                                                    
                    this.oApproveDialog = new sap.m.Dialog({                                                                                                                                                                                                   
                        type: sap.m.DialogType.Message,                                                                                                                                                                                                        
                        title: "Confirmação",                                                                                                                                                                                                                  
                        content: new sap.m.Text({ text: "Emilinar todos os registros?" }),                                                                                                                                                                     
                        beginButton: new sap.m.Button({                                                                                                                                                                                                        
                            type: sap.m.ButtonType.Emphasized,                                                                                                                                                                                                 
                            text: "Eliminar",                                                                                                                                                                                                                  
                            press: function () {                                                                                                                                                                                                               
                                this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                   
                                this.oApproveDialog.close();                                                                                                                                                                                                   
                                this.oApproveDialog.destroy();                                                                                                                                                                                                 
                                this.oApproveDialog = null                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            }.bind(this)                                                                                                                                                                                                                       
                        }),                                                                                                                                                                                                                                    
                        endButton: new sap.m.Button({                                                                                                                                                                                                          
                            text: "Cancelar",                                                                                                                                                                                                                  
                            press: function () {                                                                                                                                                                                                               
                                this.oApproveDialog.close();                                                                                                                                                                                                   
                                this.oApproveDialog.destroy();                                                                                                                                                                                                 
                                this.oApproveDialog = null                                                                                                                                                                                                     
                            }.bind(this)                                                                                                                                                                                                                       
                        })                                                                                                                                                                                                                                     
                    });                                                                                                                                                                                                                                        
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                this.oApproveDialog.open();                                                                                                                                                                                                                    
            }                                                                                                                                                                                                                                                  
        }                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
    })                                                                                                                                                                                                                                                         